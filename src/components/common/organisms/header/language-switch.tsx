"use client";
import React from "react";
import { cn, Utils } from "@lib/utils";
import { usePathname, useRouter } from "@navigation";
import { useLocale } from "next-intl";
import { useSearchParams } from "next/navigation";

export const LanguageSwitch = ({ className }: { className?: string }) => {
  const router = useRouter();
  const pathname = usePathname();
  const locale = useLocale();
  const searchParams = useSearchParams();
  const query = {
    ...Object.fromEntries(searchParams.entries()),
  };
  const url = `${pathname}${Utils.generateQueryString(query)}`;

  const changeLanguageAction = () => {
    const newLang = locale === "ar" ? "en" : "ar";
    router.push(url, { locale: newLang });
  };

  return (
    <button
      onClick={() => changeLanguageAction()}
      aria-label="Toggle Language"
      className={cn(
        `cursor-pointer hover:bg-accent hover:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4`,
        className
      )}
    >
      <svg
        width="16"
        height="16"
        viewBox="0 0 22 22"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M8.54883 0.25C10.1511 0.249988 11.4206 0.250439 12.4248 0.369141C13.4557 0.49101 14.3047 0.746327 15.0137 1.32812C15.2541 1.52544 15.4746 1.74592 15.6719 1.98633C16.3773 2.8459 16.6095 3.92388 16.6953 5.30469C18.0758 5.39054 19.1539 5.6225 20.0137 6.32812C20.2541 6.52544 20.4746 6.74592 20.6719 6.98633C21.2537 7.69525 21.509 8.54427 21.6309 9.5752C21.7496 10.5794 21.75 11.8489 21.75 13.4512V13.5488C21.75 15.1511 21.7496 16.4206 21.6309 17.4248C21.509 18.4557 21.2537 19.3047 20.6719 20.0137C20.4746 20.2541 20.2541 20.4746 20.0137 20.6719C19.3047 21.2537 18.4557 21.509 17.4248 21.6309C16.4206 21.7496 15.1511 21.75 13.5488 21.75H13.4512C11.8489 21.75 10.5794 21.7496 9.5752 21.6309C8.54427 21.509 7.69525 21.2537 6.98633 20.6719C6.74592 20.4746 6.52544 20.2541 6.32812 20.0137C5.6227 19.1541 5.39055 18.0761 5.30469 16.6953C3.92389 16.6095 2.84589 16.3773 1.98633 15.6719C1.74592 15.4746 1.52544 15.2541 1.32812 15.0137C0.746327 14.3047 0.49101 13.4557 0.369141 12.4248C0.250439 11.4206 0.249988 10.1511 0.25 8.54883V8.45117C0.249988 6.84891 0.250439 5.57941 0.369141 4.5752C0.49101 3.54427 0.746328 2.69525 1.32812 1.98633C1.52544 1.74592 1.74592 1.52544 1.98633 1.32812C2.69525 0.746328 3.54427 0.49101 4.5752 0.369141C5.57941 0.250439 6.84891 0.249988 8.45117 0.25H8.54883ZM6.78418 16.2773C6.85239 17.778 7.04947 18.5278 7.4873 19.0615C7.62236 19.2261 7.77392 19.3776 7.93848 19.5127C8.33579 19.8386 8.8621 20.0365 9.75098 20.1416C10.6569 20.2487 11.8379 20.25 13.5 20.25C15.1621 20.25 16.3431 20.2487 17.249 20.1416C18.1379 20.0365 18.6642 19.8386 19.0615 19.5127C19.2261 19.3776 19.3776 19.2261 19.5127 19.0615C19.8386 18.6642 20.0365 18.1379 20.1416 17.249C20.2487 16.3431 20.25 15.1621 20.25 13.5C20.25 11.8379 20.2487 10.6569 20.1416 9.75098C20.0365 8.8621 19.8386 8.33579 19.5127 7.93848C19.3776 7.77392 19.2261 7.62236 19.0615 7.4873C18.5305 7.05168 17.7851 6.85421 16.2979 6.78516L6.78418 16.2773ZM14.5 11.25C14.8028 11.25 15.0759 11.4324 15.1924 11.7119L17.6924 17.7119C17.8514 18.0941 17.6711 18.533 17.2891 18.6924C16.9067 18.8517 16.4669 18.6704 16.3076 18.2881L15.667 16.75H13.334L12.6924 18.2881C12.5331 18.6704 12.0942 18.8516 11.7119 18.6924C11.3297 18.5331 11.1486 18.0942 11.3076 17.7119L13.8076 11.7119C13.924 11.4325 14.1973 11.2501 14.5 11.25ZM13.959 15.25H15.042L14.5 13.9502L13.959 15.25ZM8.5 1.75C6.83789 1.75 5.65689 1.75132 4.75098 1.8584C3.8621 1.9635 3.33579 2.16138 2.93848 2.4873C2.77392 2.62236 2.62236 2.77392 2.4873 2.93848C2.16138 3.33579 1.9635 3.8621 1.8584 4.75098C1.75132 5.65689 1.75 6.83789 1.75 8.5C1.75 10.1621 1.75132 11.3431 1.8584 12.249C1.9635 13.1379 2.16138 13.6642 2.4873 14.0615C2.62236 14.2261 2.77392 14.3776 2.93848 14.5127C3.47232 14.9506 4.22229 15.1477 5.72363 15.2158L15.2168 5.74512C15.1495 4.22946 14.9527 3.47486 14.5127 2.93848C14.3776 2.77392 14.2261 2.62236 14.0615 2.4873C13.6642 2.16138 13.1379 1.9635 12.249 1.8584C11.3431 1.75132 10.1621 1.75 8.5 1.75ZM7.15039 3.25C7.56442 3.25021 7.90039 3.58592 7.90039 4V4.21582H11C11.4142 4.21582 11.75 4.55161 11.75 4.96582C11.7498 5.37989 11.4141 5.71582 11 5.71582H9.79688C9.42702 6.74677 8.85447 7.71118 8.21387 8.57715L9.11523 9.51465C9.40239 9.81317 9.39325 10.288 9.09473 10.5752C8.79619 10.8621 8.32127 10.8531 8.03418 10.5547L7.26172 9.75098C6.66032 10.432 6.04029 11.0388 5.48242 11.5518C5.17754 11.8321 4.70323 11.8127 4.42285 11.5078C4.14248 11.2029 4.16287 10.7286 4.46777 10.4482C5.03861 9.92333 5.66261 9.30703 6.25391 8.62402C6.12869 8.4631 6.0032 8.2957 5.88574 8.13281C5.6501 7.80603 5.4084 7.44505 5.28516 7.18066C5.11018 6.80523 5.273 6.35857 5.64844 6.18359C6.0238 6.00886 6.46959 6.17157 6.64453 6.54688C6.7013 6.66869 6.86572 6.92745 7.10254 7.25586C7.13792 7.30493 7.1743 7.35483 7.21094 7.4043C7.59256 6.8594 7.92523 6.29332 8.18164 5.71582H4C3.58589 5.71582 3.25016 5.37989 3.25 4.96582C3.25 4.55161 3.58579 4.21582 4 4.21582H6.40039V4C6.40039 3.58579 6.73618 3.25 7.15039 3.25Z"
          fill="currentColor"
        />
      </svg>
      {locale === "ar" ? "English" : "عربي"}
    </button>
  );
};
